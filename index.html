<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Goal Game</title>
<style>
html,body{height:100%;margin:0;background:#0b1f2a}*{box-sizing:border-box}
#game{width:100vw;height:100vh;position:relative;overflow:hidden}
.rc{position:fixed;inset:0;width:100%;height:100%;display:none;z-index:10;background:#0b1f2a;opacity:0;pointer-events:none;transition:opacity 1s ease}
.rc.ui-on{opacity:1;pointer-events:auto}
.abs{position:absolute}.pn{position:absolute;overflow:hidden}.fi{position:absolute;inset:0;width:100%;height:100%;display:block}
.rw,.sw{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;max-width:calc(100vh * 540 / 960);height:100%;margin:0 auto;font-size:2.25vh}
.gs,.rs{position:absolute;inset:0;background-size:cover}.gs span,.rs span{font-family:Montserrat,sans-serif;font-weight:700}
.rs{background:#000 url("https://gameclaydev.github.io/goal_game/UI/Win_Back.png") no-repeat center top}
.tb{width:51%;height:9%;top:8%;left:24%}.cc{width:45%;height:34%;top:21%;left:27%}.rcd{width:39%;height:10%;top:58%;left:30%}
.rcl,.rml,.rmv,.rca{font-family:Montserrat,sans-serif;font-weight:700;font-size:1em}
.rcl{width:48%;color:#fff;top:59%;left:7%;text-align:left}
.rml{width:72%;color:rgba(89,7,8,1);top:10%;left:6%;text-align:left}
.rmv{width:23%;color:#fff;top:10%;left:76%;text-align:center}
.rca{width:33%;color:#fff;top:59%;left:67%;text-align:center}
.rci{width:11%;height:26%;top:59%;left:58%}
.cb{width:40%;height:9%;top:78%;left:29%}
.cbt{width:95%;color:rgba(208,40,49,1);top:27%;left:3%;font-family:Montserrat,sans-serif;font-weight:700;font-size:1.5em;text-align:center}
.lsc{background:#000 url("https://gameclaydev.github.io/goal_game/UI/Loose_Back.png") no-repeat center top}
.lt{width:51%;height:9%;top:7%;left:25%}.lg{width:43%;height:21%;top:29%;left:28%}.lp{width:48%;height:13%;top:58%;left:26%}
.lpt{width:89%;color:#fff;top:45%;left:5%;text-align:center}
.lps{width:95%;color:#fff;top:70%;left:3%;text-align:center}
.lml{width:53%;color:rgba(89,7,8,1);top:6%;left:15%;text-align:left}
.lmv{width:18%;color:#fff;top:6%;left:71%;text-align:center}
.lbb{width:40%;height:9%;top:78%;left:29%}
.lbt{width:95%;color:rgba(0,41,68,1);top:25%;left:3%;font-size:1.5em;text-align:center}
.lds{background:#000 url("https://gameclaydev.github.io/goal_game/UI/First_List_Back.png") no-repeat center top}
.ldt{width:51%;height:9%;top:7%;left:25%}.ldg{width:80%;height:52%;top:25%;left:2%}.ldb{width:61%;height:3%;top:82%;left:22%;overflow:hidden}
.ldf{width:0%;height:67%;top:16%;left:1%;transition:width 5s linear}.ldf.fill-full{width:98%}
.ldtx{width:42%;color:#fff;top:86%;left:31%;font-size:1.2em;text-align:center}
</style>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js" crossorigin="anonymous"></script>
</head>
<body>
<div id="game"></div>
<div id="loading-screen" class="rc ui-on" style="display:block"><div class="sw"><div class="gs lds"><img class="ldt abs" src="https://gameclaydev.github.io/goal_game/UI/Logo_Draft.png" alt="Game Logo"/><img class="ldg abs" src="https://gameclaydev.github.io/goal_game/UI/First_Player.png" alt="Loading"/><div class="ldb pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Loading_BarBack.png" alt="Loading bar background"/><img class="ldf abs" src="https://gameclaydev.github.io/goal_game/UI/Loading_Bar.png" alt="Loading bar"/></div><span class="ldtx abs">LOADING</span></div></div></div>
<div id="reward-screen" class="rc"><div class="rw"><div class="rs"><img class="tb abs" src="https://gameclaydev.github.io/goal_game/UI/Logo_Draft.png" alt="Game Logo"/><img class="cc abs" src="https://gameclaydev.github.io/goal_game/UI/Win_Logo.png" alt="Victory"/><div class="rcd pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Win_ResultBack.png" alt="Reward background"/><img class="rci abs" src="https://gameclaydev.github.io/goal_game/UI/Win_Coin.png" alt="Reward coin"/><span class="rcl abs">REWARD</span><span class="rml abs">MULTIPLIER</span><span class="rmv abs" id="reward-mult">x10</span><span class="rca abs" id="reward-amount">1000</span></div><div class="cb pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Button.png" alt="Get prize button"/><span class="cbt abs">GET PRIZE</span></div></div></div></div>
<div id="lose-screen" class="rc"><div class="sw"><div class="gs lsc"><img class="lt abs" src="https://gameclaydev.github.io/goal_game/UI/Logo_Draft.png" alt="Game Logo"/><img class="lg abs" src="https://gameclaydev.github.io/goal_game/UI/Loose_Logo.png" alt="Lose"/><div class="lp pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Loose_ResultBack.png" alt="Lose info background"/><span class="lpt abs">NO REWARD</span><span class="lps abs">TRY AGAIN NEXT DAY</span><span class="lml abs">MULTIPLIER</span><span class="lmv abs" id="lose-mult">x10</span></div><div class="lbb pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Button_Gray.png" alt="Back button"/><span class="lbt abs">BACK</span></div></div></div></div>
<script>
var FADE_MS=1000;
function uiShow(el){if(!el)return;if(el._uiHideT){clearTimeout(el._uiHideT);el._uiHideT=null;}el.classList.remove("ui-on");el.style.display="block";void el.offsetWidth;el.classList.add("ui-on");}
function uiHide(el){if(!el)return;el.classList.remove("ui-on");if(el._uiHideT)clearTimeout(el._uiHideT);el._uiHideT=setTimeout(function(){if(!el.classList.contains("ui-on"))el.style.display="none";},FADE_MS);}
function getConfetti(){if(window._confettiFn)return window._confettiFn;if(typeof window.confetti!=="function")return null;var c=document.getElementById("confetti-canvas");if(!c){c=document.createElement("canvas");c.id="confetti-canvas";c.style.position="fixed";c.style.inset="0";c.style.width="100%";c.style.height="100%";c.style.pointerEvents="none";c.style.zIndex="9999";document.body.appendChild(c);}window._confettiFn=(typeof window.confetti.create==="function")?window.confetti.create(c,{resize:true}):window.confetti;return window._confettiFn;}
function _fireworksAt(oxL,oxR,oy,pc,ticks,sv,delayMs){var cf=getConfetti();if(!cf)return;var colors=["#ffffff","#ffd400"];sv=(typeof sv==="number")?sv:55;delayMs=(typeof delayMs==="number")?delayMs:0;try{cf({particleCount:pc,angle:60,spread:70,startVelocity:sv,origin:{x:oxL,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});if(delayMs>0){setTimeout(function(){try{cf({particleCount:pc,angle:120,spread:70,startVelocity:sv,origin:{x:oxR,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});}catch(e){}},delayMs);}else{cf({particleCount:pc,angle:120,spread:70,startVelocity:sv,origin:{x:oxR,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});}}catch(e){}}
function _winFireworkBounds(){var ww=(window.innerWidth||1),wh=(window.innerHeight||1);var wrapW=Math.min(ww,wh*(540/960));var left=(ww-wrapW)/2;var right=left+wrapW;var off=100/ww;var oy=0.6;return{oxL:(left/ww)-off,oxR:(right/ww)+off,oy:oy};}
function _catchFireworkBounds(){var ww=(window.innerWidth||1),wh=(window.innerHeight||1);var wrapW=Math.min(ww,wh*(540/960));var left=(ww-wrapW)/2;var right=left+wrapW;var off=50/ww;var oy=Math.max(0,0.6-(200/wh));return{oxL:(left/ww)-off,oxR:(right/ww)+off,oy:oy};}
function fireworksConfetti(){var b=_winFireworkBounds();_fireworksAt(b.oxL,b.oxR,b.oy,90,180,55,0);}
function catchConfetti(){var b=_catchFireworkBounds();_fireworksAt(b.oxL,b.oxR,b.oy,22,90,21,0);}
function showHtmlReward(mult,amount){var r=document.getElementById("reward-screen");if(!r)return;uiShow(r);fireworksConfetti();var m=document.getElementById("reward-mult"),a=document.getElementById("reward-amount");if(m)m.textContent="x"+mult;if(a)a.textContent=String(amount);}
function hideHtmlReward(){uiHide(document.getElementById("reward-screen"));}
function showHtmlLose(mult){var r=document.getElementById("lose-screen");if(!r)return;uiShow(r);var m=document.getElementById("lose-mult");if(m)m.textContent="x"+mult;}
function hideHtmlLose(){uiHide(document.getElementById("lose-screen"));}
function restartGameFromUi(){try{var g=window._GAME;var sc=g&&g.scene&&g.scene.keys&&g.scene.keys.game;if(sc&&sc.restart)sc.restart();}catch(e){console.error(e)}}
function startLoading(){var r=document.getElementById("loading-screen");if(!r)return;r.style.display="block";r.classList.add("ui-on");var f=r.querySelector(".ldf");if(f)f.classList.add("fill-full");setTimeout(function(){uiHide(r)},5000);}
document.addEventListener("DOMContentLoaded",function(){var c=document.querySelector("#reward-screen .cb");if(c)c.addEventListener("click",function(){hideHtmlReward();restartGameFromUi();});var b=document.querySelector("#lose-screen .lbb");if(b)b.addEventListener("click",function(){hideHtmlLose();restartGameFromUi();});if(typeof bootGame==="function")bootGame();startLoading();});
</script>
<script>
var BASE="https://gameclaydev.github.io/goal_game/",ENABLE_SWOOSH=true,PLAYER_H=300;
var STATIC={GrassFull:BASE+"Grass_Full.png",Grass:BASE+"Grass.jpg?v=5",FieldMarks:BASE+"Football_field.svg?v=2",UI_Button:BASE+"UI/Button.png",UI_ProgressTop:BASE+"UI/Start_ProgressTop.png",UI_ProgressStrip:BASE+"UI/Start_Progress_BackLine.png",UI_ProgressBack:BASE+"UI/Start_Progress_Back.png",UI_ProgressFill:BASE+"UI/Start_Progress.png",UI_Swoosh:BASE+"UI/swoosh.png"};
var ANIMS={Hair:{Run:{url:BASE+"Run.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Idle:{url:BASE+"Idle.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true},Idle_Back:{url:BASE+"Idle_Back.png",frameW:300,frameH:400,frames:1,fps:24,loop:true},Kick:{url:BASE+"Kick.png",frameW:377.3333,frameH:468,frames:26,fps:24,loop:false}},Bald:{Run:{url:BASE+"Run_Bald.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Idle:{url:BASE+"Idle_Bald.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true},Idle_Back:{url:BASE+"Idle_Back_Bald.png",frameW:300,frameH:400,frames:1,fps:24,loop:true},Kick:{url:BASE+"Kick_Bald.png",frameW:377.3333,frameH:468,frames:26,fps:24,loop:false}},Ball:{Fly:{url:BASE+"Ball_Anim.png",frameW:100,frameH:100,frames:20,fps:20,loop:true}},Enemy:{Enemy_Run:{url:BASE+"Run_Enemy.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Enemy_Idle:{url:BASE+"Idle_Enemy.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true}}};
var Assets={ready:false,animKey:function(action,skin){return skin==="Bald"?action+"_Bald":action;},load:function(scene,done){if(this.ready){done&&done();return;}var entries=[];Object.keys(ANIMS).forEach(function(s){Object.keys(ANIMS[s]).forEach(function(a){entries.push({skin:s,action:a,conf:ANIMS[s][a]});});});var remaining=entries.length+Object.keys(STATIC).length;var self=this;function maybeDone(){if(remaining===0){self.ready=true;done&&done();}}Object.keys(STATIC).forEach(function(name){var key=name,url=STATIC[name];var img=new Image();img.crossOrigin="anonymous";img.onload=function(){try{scene._staticImgs=scene._staticImgs||{};scene._staticImgs[key]=img;if(!scene.textures.exists(key))scene.textures.addImage(key,img);}catch(e){console.error(e);}remaining--;maybeDone();};img.onerror=function(){remaining--;maybeDone();};img.src=url;});entries.forEach(function(ent){var key="tx:"+ent.skin+":"+ent.action;var img=new Image();img.crossOrigin="anonymous";img.onload=function(){try{var iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height;var fw=ent.conf.frameW,fh=ent.conf.frameH;var want=Math.max(1,ent.conf.frames|0);if(!iw||!ih){remaining--;maybeDone();return;}var cols=Math.floor(iw/fw),rows=Math.floor(ih/fh);if(!scene.textures.exists(key)){var tex=scene.textures.addImage(key,img);var added=0;if(cols>=1&&rows>=1){for(var r=0;r<rows&&added<want;r++){for(var c=0;c<cols&&added<want;c++){tex.add("f"+added,0,Math.round(c*fw),Math.round(r*fh),Math.round(fw),Math.round(fh));added++;}}if(added===0)tex.add("f0",0,0,0,iw,ih);}else tex.add("f0",0,0,0,iw,ih);}var akey=(ent.skin==="Bald")?ent.action+"_Bald":ent.action;if(!scene.anims.exists(akey)){var names=scene.textures.get(key).getFrameNames().filter(function(n){return(n+"").charAt(0)==="f";});if(names.length===0)names=["f0"];names=names.slice(0,want);scene.anims.create({key:akey,frames:names.map(function(n){return{key:key,frame:n};}),frameRate:ent.conf.fps,repeat:ent.conf.loop?-1:0});}}catch(e){console.error(e);}remaining--;maybeDone();};img.onerror=function(){remaining--;maybeDone();};img.src=ent.conf.url;});}};
var GameScene=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"game"});},init:function(){this.W=540;this.H=960;this.PLAYERS_COUNT=10;this.P_SPACING_MIN=1200;this.ballHoldOffsetX=-40;this.passIndex=0;this.missChance=0.05;this.MS_STEP=0.07;this.mult=0;this.inFlight=false;this.gameOver=false;this.flightTween=null;this.camSwayTween=null;this.baseX=null;this.players=[];this.positions=[];this.enemies=[];},preload:function(){},PlayerView:undefined,EnemyView:undefined,create:function(){var scene=this;Assets.load(scene,function(){scene.startGame();});if(!this.PlayerView){var P=function(scene,x,y,skin){this.scene=scene;this.skin=skin||"Hair";this.sprite=scene.add.sprite(x,y,"tx:"+this.skin+":Idle","f0").setOrigin(0.5,1);this._applyScale("Idle");};P.prototype._frameH=function(a){var t=ANIMS[this.skin]||{},c=t[a]||null;return c?c.frameH:300;};P.prototype._applyScale=function(a){var base=(ANIMS[this.skin]&&ANIMS[this.skin].Run)?ANIMS[this.skin].Run:{frameH:432};this.sprite.setScale(PLAYER_H*0.85/(a==="Kick"?base.frameH:this._frameH(a)));};P.prototype._lockFeet=function(apply){var b=this.sprite.getBottomCenter();apply.call(this);var a=this.sprite.getBottomCenter();this.sprite.y+=b.y-a.y;};P.prototype.playIdle=function(){var self=this;this._lockFeet(function(){self._applyScale("Idle");self.sprite.play(Assets.animKey("Idle",self.skin));});};P.prototype.playRunAmbient=function(){var self=this;this._lockFeet(function(){self._applyScale("Run");self.sprite.play(Assets.animKey("Run",self.skin));});};P.prototype.playKick=function(onTrig){var self=this,key=Assets.animKey("Kick",this.skin),sp=this.sprite,scn=this.scene;this._lockFeet(function(){self._applyScale("Kick");sp.play(key);});var kc=(ANIMS[this.skin]&&ANIMS[this.skin].Kick)||null;var d=kc?(kc.frames/kc.fps)*1000:600;scn.time.delayedCall(d*0.15,function(){onTrig&&onTrig();});};this.PlayerView=P;}if(!this.EnemyView){var E=function(scene,x,y){this.scene=scene;this.skin="Enemy";this.sprite=scene.add.sprite(x,y,"tx:Enemy:Enemy_Idle","f0").setOrigin(0.5,1);this._applyScale("Idle");};E.prototype._name=function(a){return"Enemy_"+a;};E.prototype._frameH=function(a){var t=ANIMS.Enemy||{},c=t[this._name(a)]||null;return c?c.frameH:432;};E.prototype._applyScale=function(a){this.sprite.setScale(PLAYER_H*0.85/this._frameH(a));};E.prototype._lockFeet=function(apply){var b=this.sprite.getBottomCenter();apply.call(this);var a=this.sprite.getBottomCenter();this.sprite.y+=b.y-a.y;};E.prototype.playIdle=function(){var self=this;this._lockFeet(function(){self._applyScale("Idle");self.sprite.play(self._name("Idle"));});};E.prototype.playRunAmbient=function(){var self=this;this._lockFeet(function(){self._applyScale("Run");self.sprite.play(self._name("Run"));if(self.sprite&&self.sprite.anims&&self.sprite.anims.setProgress)self.sprite.anims.setProgress(Math.random());});};this.EnemyView=E;}},legPosOf:function(node){return{x:node.x,y:node.y-PLAYER_H*0.05-60};},legPosAt:function(x,y){return{x:x,y:y-PLAYER_H*0.05-60};},startGame:function(){var bottom=this.H+600;var fullTex=this.textures.exists("GrassFull")?this.textures.get("GrassFull").getSourceImage():null;var top,worldH;var FIELD_SCALE=4;if(fullTex){var ih=fullTex.height||fullTex.naturalHeight||1;worldH=ih*FIELD_SCALE;top=bottom-worldH;}else{top=-20000;worldH=bottom-top;}var planeW=this.W;if(fullTex){var iw=fullTex.width||fullTex.naturalWidth||1;planeW=iw*FIELD_SCALE;}this.cameras.main.setBounds(0,top,planeW,worldH);this.physics.world.setBounds(0,top,planeW,worldH);var tex=this.textures.exists("Grass")?this.textures.get("Grass").getSourceImage():null;if(tex){var iw2=tex.width||tex.naturalWidth||1,sc=this.W/iw2;this.field=this.add.tileSprite(planeW/2,top+worldH/2,planeW,worldH,"Grass").setDepth(-10);this.field.setTileScale(sc,sc);}else this.add.rectangle(planeW/2,top+worldH/2,planeW,worldH,0x0b5a2a).setDepth(-10);var mk=this._staticImgs&&this._staticImgs.FieldMarks;if(mk&&!this._marksHiRes&&this.textures.exists("FieldMarks")){try{var max=8192;var s=Math.min(1,Math.min(max/planeW,max/worldH));var cw=Math.max(1,Math.round(planeW*s));var ch=Math.max(1,Math.round(worldH*s));var cv=document.createElement("canvas");cv.width=cw;cv.height=ch;var ctx=cv.getContext("2d");ctx.drawImage(mk,0,0,cw,ch);this.textures.remove("FieldMarks");this.textures.addCanvas("FieldMarks",cv);this._marksHiRes=true;}catch(e){console.error(e);}}if(this.textures.exists("FieldMarks")){this.marks=this.add.image(planeW/2,top+worldH/2,"FieldMarks").setDepth(-9).setAlpha(0.8);this.marks.setDisplaySize(planeW,worldH);}var firstY=bottom-(PLAYER_H/2+220);var topTargetY=top+(PLAYER_H/2+220);var stepY=(firstY-topTargetY)/(this.PLAYERS_COUNT-1);var centerX=planeW/2;this.positions=[];this.players=[];for(var i=0;i<this.PLAYERS_COUNT;i++){var side=(i%2===0)?-1:1;var x=Phaser.Math.Clamp(centerX+side*Phaser.Math.Between(0,1000),60,planeW-60);var y=firstY-(stepY*i);this.positions.push({x:x,y:y});}for(i=0;i<this.PLAYERS_COUNT;i++){var pos=this.positions[i];var skin=(i%2===0)?"Hair":"Bald";var off=(i===0)?0:Phaser.Math.Between(300,600);var startY=pos.y-off;var view=new this.PlayerView(this,pos.x,startY,skin);view.playRunAmbient();var hy=view.sprite.y+off;this.players.push({node:view.sprite,view:view,homeX:pos.x,homeY:hy,entryOffY:off,entryDone:(i===0)});}if(this.players[0]&&this.players[0].node&&this.players[0].view){this.players[0].node.setPosition(this.players[0].homeX,this.players[0].homeY);this.players[0].view.playIdle();this.players[0].homeY=this.players[0].node.y;}this.enemies=[];for(i=1;i<this.PLAYERS_COUNT;i++){var pl=this.players[i];if(!pl||!pl.node)continue;if(Math.random()<0.5)continue;var px=pl.homeX,py=pl.homeY;var side=(px>=planeW/2)?-1:1;var dx=side*Phaser.Math.Between(150,250);var ex=px+dx;var ey=py+Phaser.Math.Between(-200,200);var eoff=Phaser.Math.Between(150,300);var ev=new this.EnemyView(this,ex,ey-eoff);ev.playRunAmbient();var ehy=ev.sprite.y+eoff;ev.sprite.setDepth(pl.node.depth);this.enemies.push({node:ev.sprite,view:ev,ownerIndex:i,homeY:ehy,entryOffY:eoff,entryDone:false});}var first=this.players[0].node;var leg=this.legPosOf(first);this.ball=this.add.sprite(leg.x+this.ballHoldOffsetX,leg.y,"tx:Ball:Fly","f0").setOrigin(0.5).setDepth(100);this.ballBaseScale=0.35;this.ball.setScale(this.ballBaseScale);this.ballBaseDepth=this.ball.depth;this.cameras.main.startFollow(this.ball,true,0.22,0.22);if(this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");}var last=this.players[this.PLAYERS_COUNT-1].node;this.goal=this.add.rectangle(planeW/2,last.y-260,110,26,0x2fd39f).setStrokeStyle(4,0x1aa67a).setDepth(9);this.add.text(this.goal.x,this.goal.y-36,"GOAL",{fontFamily:"Montserrat",fontStyle:"bold",fontSize:18,color:"#7fffd4"}).setOrigin(0.5).setDepth(9);var uiScale=0.5,uiX=107*uiScale;this.barStrip=this.add.image(uiX,this.H/2,"UI_ProgressStrip").setScrollFactor(0).setDepth(50).setScale(uiScale);this.barBG=this.add.image(uiX,this.H/2,"UI_ProgressBack").setScrollFactor(0).setDepth(51).setScale(uiScale);this.barFG=this.add.image(uiX,this.H/2,"UI_ProgressFill").setScrollFactor(0).setDepth(52);this.barFG.setOrigin(0.5,1).setScale(uiScale);this.barFG.y=this.barBG.y+this.barBG.displayHeight/2;this.PROGRESS_STEPS=10;this.barFGFrameW=(this.barFG.frame&&(this.barFG.frame.cutWidth||this.barFG.frame.width))||1;this.barFGFrameH=(this.barFG.frame&&(this.barFG.frame.cutHeight||this.barFG.frame.height))||1;this.barFG.setCrop(0,this.barFGFrameH,this.barFGFrameW,0);this.multBadge=this.add.image(uiX,(164+90/2)*uiScale,"UI_ProgressTop").setScrollFactor(0).setDepth(53).setScale(uiScale);this.multText=this.add.text(uiX,(186+40/2)*uiScale,"x0",{fontFamily:"Montserrat",fontSize:20,color:"#fff"}).setOrigin(0.5).setScrollFactor(0).setDepth(54);this.swooshStopY=this.multBadge.y+(this.multBadge.displayHeight/2)+106;this.barBottomY=(this.barBG&&this.barBG.displayHeight)?(this.barBG.y+this.barBG.displayHeight/2):this.barFG.y;this.barTopY=this.swooshStopY;this._lastHudStep=-1;this.swooshTween=null;if(ENABLE_SWOOSH){this.swoosh=this.add.image(uiX,this.barBottomY,"UI_Swoosh").setScrollFactor(0).setDepth(52.9).setScale(uiScale).setOrigin(0.5,1);this.swoosh.setAlpha(0.6);this.swoosh.setVisible(false);}else this.swoosh=null;var mkBtn=(function(scene){return function(label,x,y,onTap){var img=scene.add.image(x,y,"UI_Button").setDepth(2000).setScrollFactor(0).setScale(0.5);var tx=scene.add.text(x,y,label,{fontFamily:"Montserrat",fontSize:30,color:"#d02831"}).setOrigin(0.5).setDepth(2001).setScrollFactor(0);img.setInteractive({useHandCursor:true}).on("pointerdown",function(){onTap();});return{show:function(v){img.setVisible(v);tx.setVisible(v);v?img.setInteractive({useHandCursor:true}):img.disableInteractive();},active:function(v){img.setAlpha(v?1:0.5);tx.setAlpha(v?1:0.5);v?img.setInteractive({useHandCursor:true}):img.disableInteractive();}};};})(this);var btnY=(1506+172/2)*0.5;this.passBtn=mkBtn("START",this.W/2,btnY,(function(scene){return function(){if(scene.inFlight||scene.gameOver)return;scene.setPassCatchState(false,true);scene.catchBtn&&scene.catchBtn.active&&scene.catchBtn.active(false);scene.pass();};})(this));this.catchBtn=mkBtn("CATCH!",this.W/2,btnY,(function(scene){return function(){scene.catch();};})(this));this.setPassCatchState(true,false);this._lastHudStep=-1;if(this.swoosh){this.swoosh.setVisible(false);}this.updateHUD();},setPassCatchState:function(showPass,showCatch){this.passBtn&&this.passBtn.show(showPass);this.catchBtn&&this.catchBtn.show(showCatch);if(showCatch&&this.catchBtn&&this.catchBtn.active)this.catchBtn.active(false);},stepForMult:function(m){var steps=this.PROGRESS_STEPS||10;var mm=Math.min(m,steps);return Phaser.Math.Clamp(mm,0,steps);},updateHUD:function(){var steps=this.PROGRESS_STEPS||10;var dm=Math.min(this.mult,steps);var step=this.stepForMult(dm);if(this.barFG&&this.barFGFrameH){var cropH=Math.round(this.barFGFrameH*(step/steps));cropH=Phaser.Math.Clamp(cropH,0,this.barFGFrameH);var y=this.barFGFrameH-cropH;this.barFG.setCrop(0,y,this.barFGFrameW,cropH);if(ENABLE_SWOOSH&&this.swoosh){if(this._lastHudStep<0){this._lastHudStep=step;}else if(step>this._lastHudStep){this._lastHudStep=step;this.tweens.killTweensOf(this.swoosh);this.barBottomY=(this.barBG&&this.barBG.displayHeight)?(this.barBG.y+this.barBG.displayHeight/2):this.barBottomY;this.barTopY=(this.swooshStopY!=null)?this.swooshStopY:this.barTopY;this.swoosh.y=this.barBottomY;this.swoosh.setVisible(true);this.swooshTween=this.tweens.add({targets:this.swoosh,y:this.barTopY,duration:180,ease:"Sine.easeOut",onComplete:(function(scn){return function(){if(scn.swoosh)scn.swoosh.setVisible(false);scn.swooshTween=null;};})(this)});}else this._lastHudStep=step;}}if(this.multText)this.multText.setText("x"+dm.toFixed(0));},popMultiplierAt:function(target,mult){if(!target)return;var x=target.x,y=target.y-PLAYER_H-10;var txt=this.add.text(x,y,"x"+mult,{fontFamily:"Montserrat",fontStyle:"bold",fontSize:28,color:"#fff"}).setOrigin(0.5).setDepth(500);txt.setScale(0.4);txt.alpha=0;var scn=this;this.tweens.add({targets:txt,alpha:1,scaleX:2.4,scaleY:2.4,duration:210,ease:"Back.Out",onComplete:function(){scn.tweens.add({targets:txt,y:txt.y-24,alpha:0,duration:570,onComplete:function(){txt.destroy();}});}});},startEnemyEntry:function(owner,delay){for(var i=0;i<this.enemies.length;i++){var en=this.enemies[i];if(!en||!en.node||en.ownerIndex!==owner)continue;if(en.entryDone)return;en.entryDone=true;var self=this;var hy=(typeof en.homeY==="number")?en.homeY:en.node.y;var off=(typeof en.entryOffY==="number")?en.entryOffY:Phaser.Math.Between(150,300);en.entryOffY=off;var run=function(){if(!en.node||!en.node.scene)return;en.node.y=hy-off;self.tweens.add({targets:en.node,y:hy,duration:1600,ease:"Sine.easeOut",onComplete:function(){en.view&&en.view.playIdle&&en.view.playIdle();}});};(delay&&delay>0)?this.time.delayedCall(delay,run):run();return;}},startPlayerEntry:function(idx,delay){var pl=this.players[idx];if(!pl||!pl.node||pl.entryDone)return;pl.entryDone=true;var self=this;var hy=(typeof pl.homeY==="number")?pl.homeY:pl.node.y;var off=(typeof pl.entryOffY==="number")?pl.entryOffY:Phaser.Math.Between(300,600);pl.entryOffY=off;var run=function(){if(!pl.node||!pl.node.scene)return;pl.node.y=hy-off;self.tweens.add({targets:pl.node,y:hy,duration:600,ease:"Sine.easeOut"});};(delay&&delay>0)?this.time.delayedCall(delay,run):run();},pass:function(){var self=this;if(this.catchBtn&&this.catchBtn.active)this.catchBtn.active(false);if(this.passIndex>=this.PLAYERS_COUNT-1){var lastV=this.players[this.passIndex]&&this.players[this.passIndex].view;if(this.ball&&lastV&&lastV.sprite){this.ball.setDepth(lastV.sprite.depth-1);var ln=this.players[this.passIndex]&&this.players[this.passIndex].node;if(ln){var ll=this.legPosOf(ln);this.ball.setPosition(ll.x,ll.y);}}lastV&&lastV.playKick(function(){self.passToGoal();});return;}var pv=this.players[this.passIndex]&&this.players[this.passIndex].view;if(this.ball&&pv&&pv.sprite){this.ball.setDepth(pv.sprite.depth-1);var pn=this.players[this.passIndex]&&this.players[this.passIndex].node;if(pn){var lp=this.legPosOf(pn);this.ball.setPosition(lp.x,lp.y);}}pv&&pv.playKick(function(){self.toTarget(self.passIndex+1);});},toTarget:function(i){var self=this;var target=this.players[i]&&this.players[i].node;this.inFlight=true;var dur=2000+Phaser.Math.Between(0,1000);var delay=Math.floor(dur*0.6);this.startPlayerEntry(i,delay);this.startEnemyEntry(i,delay);var hx=(this.players[i]&&typeof this.players[i].homeX==="number")?this.players[i].homeX:(target?target.x:this.W/2);var hy=(this.players[i]&&typeof this.players[i].homeY==="number")?this.players[i].homeY:(target?target.y:0);var leg=this.legPosAt(hx,hy);var miss=Math.random()<this.missChance;if(miss){var mx=Phaser.Math.Linear(this.ball.x,leg.x,0.6)+Phaser.Math.Between(-80,80);var my=leg.y-120;this.flyArc(mx,my,dur,function(){self.fail();});this.cameras.main.shake(300,0.0045);return;}this.flyArc(leg.x+this.ballHoldOffsetX,leg.y,dur,function(){self.passIndex=i;self.players[i]&&self.players[i].view&&self.players[i].view.playIdle();self.mult+=1;self.missChance+=self.MS_STEP;self.inFlight=false;self.cameras.main.shake(300,0.0045);self.updateHUD();if(typeof catchConfetti==="function")catchConfetti();self.popMultiplierAt(target,self.mult);self.setPassCatchState(false,true);self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(true);self.time.delayedCall(1200,function(){self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(false);if(!self.inFlight&&!self.gameOver){if(i<self.PLAYERS_COUNT-1)self.pass();else self.passToGoal();}});},target);},passToGoal:function(){var self=this;var dur=2000+Phaser.Math.Between(0,1000);var miss=Math.random()<this.missChance;if(miss){var mx=this.goal.x+Phaser.Math.Between(-120,120);var my=this.goal.y-140;this.flyArc(mx,my,dur,function(){self.fail();});this.cameras.main.shake(300,0.0045);return;}this.flyArc(this.goal.x,this.goal.y+6,dur,function(){self.players[self.passIndex]&&self.players[self.passIndex].view&&self.players[self.passIndex].view.playIdle();self.mult+=1;self.missChance+=self.MS_STEP;self.inFlight=false;self.updateHUD();if(typeof catchConfetti==="function")catchConfetti();self.passIndex=0;var f=self.players[0]&&self.players[0].node;if(f&&self.ball){var l=self.legPosOf(f);self.ball.setPosition(l.x+self.ballHoldOffsetX,l.y);if(typeof self.ballBaseDepth==="number")self.ball.setDepth(self.ballBaseDepth);if(self.ball.anims&&self.ball.anims.stop)self.ball.anims.stop();if(self.ball.setFrame)self.ball.setFrame("f0");self.ball.setScale(self.ballBaseScale,self.ballBaseScale);}self.popMultiplierAt(f,self.mult);self.setPassCatchState(false,true);self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(true);self.time.delayedCall(1200,function(){self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(false);if(!self.inFlight&&!self.gameOver)self.pass();});});},flyArc:function(tx,ty,d,cb,nextNode){var cam=this.cameras.main;if(cam&&cam.followOffset){var off=Phaser.Math.Between(-120,120);if(this.camSwayTween){this.camSwayTween.stop();this.camSwayTween=null;}this.camSwayTween=this.tweens.add({targets:cam.followOffset,x:off,duration:Math.max(300,Math.round(d*0.8)),ease:"Sine.easeInOut"});}var s=new Phaser.Math.Vector2(this.ball.x,this.ball.y);var e=new Phaser.Math.Vector2(tx,ty);var m=s.clone().add(e).scale(0.5);var tr=e.distance(s);var arc=Math.max(220,Phaser.Math.Clamp(tr*0.35,180,380));var c=new Phaser.Math.Vector2(m.x,m.y-arc);var curve=new Phaser.Curves.QuadraticBezier(s,c,e);var self=this;var flyKey=Assets.animKey("Fly","Ball");if(self.ball&&self.ball.anims&&self.anims&&self.anims.exists(flyKey))self.ball.play(flyKey);var depthSwitched=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}this.flightTween=this.tweens.addCounter({from:0,to:1,duration:d,ease:"Sine.easeInOut",onUpdate:function(tw){var t=tw.getValue();var p=curve.getPoint(t);self.ball.setPosition(p.x,p.y);var sc=(1+0.5*Math.sin(Math.PI*t))*1.2;self.ball.setScale(self.ballBaseScale*sc,self.ballBaseScale*sc);if(!depthSwitched&&t>=0.5&&nextNode){depthSwitched=true;self.ball.setDepth(nextNode.depth+1);}},onComplete:function(){self.flightTween=null;if(self.ball&&self.ball.anims){self.ball.anims.stop();self.ball.setFrame("f0");self.ball.setScale(self.ballBaseScale,self.ballBaseScale);}cb&&cb();}});},catch:function(){if(this.gameOver)return;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}this.inFlight=false;if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");this.ball.setScale(this.ballBaseScale,this.ballBaseScale);}this.gameOver=true;var mm=this.mult.toFixed(0);var amt=Math.round(100*this.mult);if(typeof showHtmlReward==="function")showHtmlReward(mm,amt);},fail:function(){this.inFlight=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");}this.gameOver=true;this.tweens.add({targets:this.ball,scaleX:1.5,scaleY:1.5,yoyo:true,repeat:1,duration:160});if(typeof showHtmlLose==="function")showHtmlLose(this.mult.toFixed(0));},restart:function(){if(typeof hideHtmlReward==="function")hideHtmlReward();if(typeof hideHtmlLose==="function")hideHtmlLose();this.gameOver=false;this.inFlight=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");this.ball.setScale(this.ballBaseScale,this.ballBaseScale);}this.passIndex=0;this.missChance=0.05;this.mult=0;for(var i=0;i<this.players.length;i++){var pl=this.players[i];if(!pl||!pl.view||!pl.node)continue;if(typeof pl.homeX==="number")pl.node.x=pl.homeX;if(typeof pl.homeY!=="number")pl.homeY=pl.node.y;if(typeof pl.entryOffY!=="number")pl.entryOffY=(i===0)?0:Phaser.Math.Between(300,600);if(i===0){pl.entryDone=true;pl.node.y=pl.homeY;pl.view.playIdle();}else{pl.entryDone=false;pl.node.y=pl.homeY-pl.entryOffY;pl.view.playRunAmbient();}}for(i=0;i<this.enemies.length;i++){var en=this.enemies[i];if(!en||!en.view||!en.node)continue;en.view.playRunAmbient&&en.view.playRunAmbient();var pi=en.ownerIndex;var pn=this.players[pi]&&this.players[pi].node;if(pn)en.node.setDepth(pn.depth);var hy=(typeof en.homeY==="number")?en.homeY:en.node.y;if(typeof en.entryOffY!=="number")en.entryOffY=Phaser.Math.Between(150,300);en.entryDone=false;en.node.y=hy-en.entryOffY;}var f=this.players[0].node;var l=this.legPosOf(f);this.ball.setPosition(l.x+this.ballHoldOffsetX,l.y);this.ball.setScale(this.ballBaseScale,this.ballBaseScale);if(typeof this.ballBaseDepth==="number")this.ball.setDepth(this.ballBaseDepth);if(this.camSwayTween){this.camSwayTween.stop();this.camSwayTween=null;}this.cameras.main.followOffset&& (this.cameras.main.followOffset.x=0);this.cameras.main.startFollow(this.ball,true,0.22,0.22);this.cameras.main.pan(this.ball.x,this.ball.y,0);this.setPassCatchState(true,false);this.updateHUD();}});
function bootGame(){try{window._GAME&&window._GAME.destroy&&window._GAME.destroy(true);}catch(e){console.error(e);}var m=document.getElementById("game");if(m)m.innerHTML="";window._GAME=new Phaser.Game({type:Phaser.AUTO,parent:"game",backgroundColor:"#0b1f2a",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:540,height:960},dom:{createContainer:true},physics:{default:"arcade",arcade:{debug:false}},scene:[GameScene]});}
</script>
</body>
</html>
