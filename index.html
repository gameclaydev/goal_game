<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Goal Game</title>
<style>
html,body{height:100%;margin:0;background:#0b1f2a}*{box-sizing:border-box}
#game{width:100vw;height:100vh;position:relative;overflow:hidden}
.rc{position:fixed;inset:0;width:100%;height:100%;display:none;z-index:10;background:#0b1f2a;opacity:0;pointer-events:none;transition:opacity 1s ease}
.rc.ui-on{opacity:1;pointer-events:auto}
.abs{position:absolute}.pn{position:absolute;overflow:hidden}.fi{position:absolute;inset:0;width:100%;height:100%;display:block}
.rw,.sw{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;max-width:calc(100vh * 540 / 960);height:100%;margin:0 auto;font-size:2.25vh}
.gs,.rs{position:absolute;inset:0;background-size:cover}.gs span,.rs span{font-family:Montserrat,sans-serif;font-weight:700}
.rs{background:#000 url("https://gameclaydev.github.io/goal_game/UI/Win_Back.png") no-repeat center top}
.tb{width:51%;height:9%;top:8%;left:24%}.cc{width:45%;height:34%;top:21%;left:27%}.rcd{width:39%;height:10%;top:58%;left:30%}
.rcl,.rml,.rmv,.rca{font-family:Montserrat,sans-serif;font-weight:700;font-size:1em}
.rcl{width:48%;color:#fff;top:59%;left:7%;text-align:left}
.rml{width:72%;color:rgba(89,7,8,1);top:10%;left:6%;text-align:left}
.rmv{width:23%;color:#fff;top:10%;left:76%;text-align:center}
.rca{width:33%;color:#fff;top:59%;left:67%;text-align:center}
.rci{width:11%;height:26%;top:59%;left:58%}
.cb{width:40%;height:9%;top:78%;left:29%}
.cbt{width:95%;color:rgba(208,40,49,1);top:27%;left:3%;font-family:Montserrat,sans-serif;font-weight:700;font-size:1.5em;text-align:center}
.lsc{background:#000 url("https://gameclaydev.github.io/goal_game/UI/Loose_Back.png") no-repeat center top}
.lt{width:51%;height:9%;top:7%;left:25%}.lg{width:43%;height:21%;top:29%;left:28%}.lp{width:48%;height:13%;top:58%;left:26%}
.lpt{width:89%;color:#fff;top:45%;left:5%;text-align:center}
.lps{width:95%;color:#fff;top:70%;left:3%;text-align:center}
.lml{width:53%;color:rgba(89,7,8,1);top:6%;left:15%;text-align:left}
.lmv{width:18%;color:#fff;top:6%;left:71%;text-align:center}
.lbb{width:40%;height:9%;top:78%;left:29%}
.lbt{width:95%;color:rgba(0,41,68,1);top:25%;left:3%;font-size:1.5em;text-align:center}
.lds{background:#000 url("https://gameclaydev.github.io/goal_game/UI/First_List_Back.png") no-repeat center top}
.ldt{width:51%;height:9%;top:7%;left:25%}.ldg{width:80%;height:52%;top:25%;left:2%}.ldb{width:61%;height:3%;top:82%;left:22%;overflow:hidden}
.ldf{width:0%;height:67%;top:16%;left:1%;transition:width 5s linear}.ldf.fill-full{width:98%}
.ldtx{width:42%;color:#fff;top:86%;left:31%;font-size:1.2em;text-align:center}
/* WIN2 (new reward screen) */
.panel{position:absolute}
.full-img{position:absolute;inset:0;width:100%;height:100%;display:block}
.win2-root{position:absolute;inset:0;/* scale like existing .rw but without vw double-scaling */font-size:calc(min(100vw,100vh * 540 / 960) * 0.037)}
.win2-overlay{position:absolute;inset:0;background:#000;opacity:0.6;z-index:0}
/* Show gameplay under WIN screen: make the reward rc background transparent (overlay handles dim) */
#reward-screen.rc{background:transparent}
.win2-close-button{position:absolute;width:5%;height:3%;top:4%;left:5%;background:url("https://gameclaydev.github.io/goal_game/UI2/Close.png") no-repeat center center;background-size:contain;z-index:4}
.win2-header{position:absolute;width:89%;height:25%;top:16%;left:6%;z-index:2}
.win2-header-bg{position:absolute;width:100%;height:85%;top:15%;left:0}
.win2-avatar-frame{position:absolute;width:31%;height:61%;top:0;left:34%}
.win2-avatar-icon{position:absolute;width:29%;height:57%;top:2%;left:35%}
.win2-player-name{position:absolute;width:39%;top:69%;left:30%;font-size:1.25em;color:#000;text-align:center;font-family:Inter,sans-serif;font-weight:700}
.win2-card{position:absolute;width:89%;height:54%;top:20%;left:6%;z-index:1}
.win2-card-content{position:absolute;top:38%;left:15%;width:70%;text-align:center;z-index:2;font-family:Inter,sans-serif;font-weight:700}
.win2-headline{font-size:1.6em;color:#fff;margin-bottom:.1em}
.win2-amount-row{text-align:center;margin-bottom:.1em}
.win2-amount{display:inline-block;font-size:4.5em;color:#f7e542;text-shadow:0 5px 8px rgba(210,37,42,.47)}
.win2-currency{display:inline-block;font-size:1.6em;color:#fff;margin-left:.1em}
.win2-label{font-size:1.4em;color:#fff}
/* keep JS selector (#reward-screen .cb) working, but override old .cb layout */
.win2-root .cb{position:absolute;width:41%;height:5%;top:63%;left:28%;z-index:3;cursor:pointer}
.win2-cta-text{position:absolute;width:83%;top:23%;left:10%;font-size:1em;color:#000;text-align:center;font-family:Inter,sans-serif;font-weight:700}

/* LOSE2 (new lose screen, same tech as WIN2) */
.lose2-root{position:absolute;inset:0;font-size:calc(min(100vw,100vh * 540 / 960) * 0.037)}
.lose2-overlay{position:absolute;inset:0;background:#000;opacity:0.6;z-index:0}
#lose-screen.rc{background:transparent}
.lose2-close-button{position:absolute;width:5%;height:3%;top:4%;left:5%;background:url("https://gameclaydev.github.io/goal_game/UI2/Close.png") no-repeat center center;background-size:contain;z-index:4}
.lose2-header{position:absolute;width:89%;height:25%;top:16%;left:6%;z-index:2}
.lose2-header-bg{position:absolute;width:100%;height:85%;top:15%;left:0}
.lose2-icon-frame{position:absolute;width:31%;height:61%;top:0;left:34%}
.lose2-lose-icon{position:absolute;width:33%;height:58%;top:2%;left:33%}
.lose2-mult-label{position:absolute;width:34%;top:64%;left:28%;font-family:Inter,sans-serif;font-weight:700;font-size:1.25em;color:#000;text-align:left;z-index:3}
.lose2-mult-value{position:absolute;width:10%;top:64%;left:60%;font-family:Inter,sans-serif;font-weight:700;font-size:1.25em;color:rgba(192,30,37,1);text-align:center;z-index:3}
.lose2-card{position:absolute;width:89%;height:54%;top:20%;left:6%;z-index:1}
.lose2-no-reward{position:absolute;width:56%;top:46%;left:22%;font-family:Montserrat,sans-serif;font-weight:700;font-size:2em;color:#fff;text-align:center;z-index:3}
.lose2-try-again{position:absolute;width:45%;top:52%;left:27%;font-family:Montserrat,sans-serif;font-weight:700;font-size:1em;color:#fff;text-align:center;z-index:3}
/* keep JS selector (#lose-screen .lbb) working */
.lose2-root .lbb{position:absolute;width:41%;height:5%;top:61%;left:28%;z-index:3;cursor:pointer}
.lose2-cta-text{position:absolute;width:83%;top:23%;left:10%;font-family:Inter,sans-serif;font-weight:700;font-size:1em;color:#000;text-align:center}

</style>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js" crossorigin="anonymous"></script>
</head>
<body>
<div id="game"></div>
<div id="loading-screen" class="rc ui-on" style="display:block"><div class="sw"><div class="gs lds"><img class="ldt abs" src="https://gameclaydev.github.io/goal_game/UI/Logo_Draft.png" alt="Game Logo"/><img class="ldg abs" src="https://gameclaydev.github.io/goal_game/UI/First_Player.png" alt="Loading"/><div class="ldb pn"><img class="fi" src="https://gameclaydev.github.io/goal_game/UI/Loading_BarBack.png" alt="Loading bar background"/><img class="ldf abs" src="https://gameclaydev.github.io/goal_game/UI/Loading_Bar.png" alt="Loading bar"/></div><span class="ldtx abs">LOADING</span></div></div></div>
<div id="reward-screen" class="rc"><div class="rw"><div class="win2-root">
<div class="win2-overlay"></div>
<div class="win2-close-button"></div>
<div class="win2-header">
  <div class="win2-header-bg"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Back_TopYellow.png" alt="Header background"/></div>
  <div class="win2-avatar-frame"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Avatar_Back.png" alt="Avatar frame"/></div>
  <div class="win2-avatar-icon"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Avatar_IconBase.png" alt="Avatar icon"/></div>
  <span class="win2-player-name">TestCP55</span>
</div>
<div class="win2-card">
  <img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Back_RedShort.png" alt="Reward background"/>
  <div class="win2-card-content">
    <div class="win2-headline">Casa îți dă pasa!</div>
    <div class="win2-amount-row"><span class="win2-amount" id="reward-amount">50</span><span class="win2-currency">lei</span></div>
    <div class="win2-label"><span id="reward-mult" style="display:none">x0</span>FREE BET</div>
  </div>
</div>
<div class="cb"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/start_Background.png" alt="Activate button"/><span class="win2-cta-text">ACTIVATE</span></div>
</div></div></div>
<div id="lose-screen" class="rc"><div class="rw"><div class="lose2-root">
<div class="lose2-overlay"></div>
<div class="lose2-close-button"></div>
<div class="lose2-header">
  <div class="lose2-header-bg"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Back_TopYellow.png" alt="Header background"/></div>
  <div class="lose2-icon-frame"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Avatar_Back.png" alt="Icon frame"/></div>
  <div class="lose2-lose-icon"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI/Loose_Logo.png" alt="Lose icon"/></div>
  <span class="lose2-mult-label">MULTIPLIER</span>
  <span class="lose2-mult-value" id="lose-mult">x10</span>
</div>
<div class="lose2-card"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/Back_RedShort.png" alt="Lose background"/></div>
<span class="lose2-no-reward">No Reward</span>
<span class="lose2-try-again">TRY AGAIN NEXT DAY</span>
<div class="lose2-cta lbb"><img class="full-img" src="https://gameclaydev.github.io/goal_game/UI2/start_Background.png" alt="Back button"/><span class="lose2-cta-text">BACK</span></div>
</div></div></div>
<script>
var FADE_MS=1000;
function uiShow(el){if(!el)return;if(el._uiHideT){clearTimeout(el._uiHideT);el._uiHideT=null;}el.classList.remove("ui-on");el.style.display="block";void el.offsetWidth;el.classList.add("ui-on");}
function uiHide(el){if(!el)return;el.classList.remove("ui-on");if(el._uiHideT)clearTimeout(el._uiHideT);el._uiHideT=setTimeout(function(){if(!el.classList.contains("ui-on"))el.style.display="none";},FADE_MS);}
function getConfetti(){if(window._confettiFn)return window._confettiFn;if(typeof window.confetti!=="function")return null;var c=document.getElementById("confetti-canvas");if(!c){c=document.createElement("canvas");c.id="confetti-canvas";c.style.position="fixed";c.style.inset="0";c.style.width="100%";c.style.height="100%";c.style.pointerEvents="none";c.style.zIndex="9999";document.body.appendChild(c);}window._confettiFn=(typeof window.confetti.create==="function")?window.confetti.create(c,{resize:true}):window.confetti;return window._confettiFn;}
function _fireworksAt(oxL,oxR,oy,pc,ticks,sv,delayMs){var cf=getConfetti();if(!cf)return;var colors=["#ffffff","#ffd400"];sv=(typeof sv==="number")?sv:55;delayMs=(typeof delayMs==="number")?delayMs:0;try{cf({particleCount:pc,angle:60,spread:70,startVelocity:sv,origin:{x:oxL,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});if(delayMs>0){setTimeout(function(){try{cf({particleCount:pc,angle:120,spread:70,startVelocity:sv,origin:{x:oxR,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});}catch(e){}},delayMs);}else{cf({particleCount:pc,angle:120,spread:70,startVelocity:sv,origin:{x:oxR,y:oy},colors:colors,ticks:ticks,gravity:2.8,decay:0.9});}}catch(e){}}
function _winFireworkBounds(){var ww=(window.innerWidth||1),wh=(window.innerHeight||1);var wrapW=Math.min(ww,wh*(540/960));var left=(ww-wrapW)/2;var right=left+wrapW;var off=100/ww;var oy=0.6;return{oxL:(left/ww)-off,oxR:(right/ww)+off,oy:oy};}
function _catchFireworkBounds(){var ww=(window.innerWidth||1),wh=(window.innerHeight||1);var wrapW=Math.min(ww,wh*(540/960));var left=(ww-wrapW)/2;var right=left+wrapW;var off=50/ww;var oy=Math.max(0,0.6-(200/wh));return{oxL:(left/ww)-off,oxR:(right/ww)+off,oy:oy};}
function fireworksConfetti(){var b=_winFireworkBounds();_fireworksAt(b.oxL,b.oxR,b.oy,90,180,55,0);}
function catchConfetti(){var b=_catchFireworkBounds();_fireworksAt(b.oxL,b.oxR,b.oy,22,90,21,0);}
function showHtmlReward(mult,amount){var r=document.getElementById("reward-screen");if(!r)return;uiShow(r);fireworksConfetti();var m=document.getElementById("reward-mult"),a=document.getElementById("reward-amount");if(m)m.textContent="x"+mult;if(a)a.textContent=String(amount);}
function hideHtmlReward(){uiHide(document.getElementById("reward-screen"));}
function showHtmlLose(mult){var r=document.getElementById("lose-screen");if(!r)return;uiShow(r);var m=document.getElementById("lose-mult");if(m)m.textContent="x"+mult;}
function hideHtmlLose(){uiHide(document.getElementById("lose-screen"));}
function restartGameFromUi(){try{var g=window._GAME;var sc=g&&g.scene&&g.scene.keys&&g.scene.keys.game;if(sc&&sc.restart)sc.restart();}catch(e){console.error(e)}}
function startLoading(){var r=document.getElementById("loading-screen");if(!r)return;r.style.display="block";r.classList.add("ui-on");var f=r.querySelector(".ldf");if(f)f.classList.add("fill-full");setTimeout(function(){uiHide(r)},5000);}
document.addEventListener("DOMContentLoaded",function(){var c=document.querySelector("#reward-screen .cb");if(c)c.addEventListener("click",function(){hideHtmlReward();restartGameFromUi();});var b=document.querySelector("#lose-screen .lbb");if(b)b.addEventListener("click",function(){hideHtmlLose();restartGameFromUi();});if(typeof bootGame==="function")bootGame();startLoading();});
</script>
<script>
var BASE="https://gameclaydev.github.io/goal_game/",ENABLE_SWOOSH=true,ENABLE_FIELD_MARKS=false,PLAYER_H=300;
var STATIC={Grass:BASE+"Grass.jpg?v=5",FieldMarks:BASE+"Football_field.svg?v=2",UI2_LogoTop:BASE+"UI2/Logo_Top.png",UI2_HelpIcon:BASE+"UI2/Help_Icon.png",UI2_BackIcon:BASE+"UI2/Back.png",UI2_ButtonPass:BASE+"UI2/Button_Pass.png",UI2_AvatarRingS:BASE+"UI2/Avatar_BackS.png",UI2_AvatarIconS:BASE+"UI2/Avatar_IconBaseS.png",UI2_BallIcon:BASE+"UI2/ball1.png"};
var ANIMS={Hair:{Run:{url:BASE+"Run.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Idle:{url:BASE+"Idle.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true},Idle_Back:{url:BASE+"Idle_Back.png",frameW:300,frameH:400,frames:1,fps:24,loop:true},Kick:{url:BASE+"Kick.png",frameW:377.3333,frameH:468,frames:26,fps:24,loop:false}},Bald:{Run:{url:BASE+"Run_Bald.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Idle:{url:BASE+"Idle_Bald.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true},Idle_Back:{url:BASE+"Idle_Back_Bald.png",frameW:300,frameH:400,frames:1,fps:24,loop:true},Kick:{url:BASE+"Kick_Bald.png",frameW:377.3333,frameH:468,frames:26,fps:24,loop:false}},Ball:{Fly:{url:BASE+"Ball_Anim.png",frameW:100,frameH:100,frames:20,fps:20,loop:true}},Enemy:{Enemy_Run:{url:BASE+"Run_Enemy.png",frameW:332,frameH:432,frames:21,fps:24,loop:true},Enemy_Idle:{url:BASE+"Idle_Enemy.png",frameW:333.33,frameH:432,frames:28,fps:24,loop:true}}};
var Assets={ready:false,animKey:function(action,skin){return skin==="Bald"?action+"_Bald":action;},load:function(scene,done){if(this.ready){done&&done();return;}var entries=[];Object.keys(ANIMS).forEach(function(s){Object.keys(ANIMS[s]).forEach(function(a){entries.push({skin:s,action:a,conf:ANIMS[s][a]});});});var remaining=entries.length+Object.keys(STATIC).length;var self=this;function maybeDone(){if(remaining===0){self.ready=true;done&&done();}}Object.keys(STATIC).forEach(function(name){if(!ENABLE_FIELD_MARKS&&name==="FieldMarks"){remaining--;maybeDone();return;}var key=name,url=STATIC[name];var img=new Image();img.crossOrigin="anonymous";img.onload=function(){try{scene._staticImgs=scene._staticImgs||{};scene._staticImgs[key]=img;if(!scene.textures.exists(key))scene.textures.addImage(key,img);}catch(e){console.error(e);}remaining--;maybeDone();};img.onerror=function(){remaining--;maybeDone();};img.src=url;});entries.forEach(function(ent){var key="tx:"+ent.skin+":"+ent.action;var img=new Image();img.crossOrigin="anonymous";img.onload=function(){try{var iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height;var fw=ent.conf.frameW,fh=ent.conf.frameH;var want=Math.max(1,ent.conf.frames|0);if(!iw||!ih){remaining--;maybeDone();return;}var cols=Math.floor(iw/fw),rows=Math.floor(ih/fh);if(!scene.textures.exists(key)){var tex=scene.textures.addImage(key,img);var added=0;if(cols>=1&&rows>=1){for(var r=0;r<rows&&added<want;r++){for(var c=0;c<cols&&added<want;c++){tex.add("f"+added,0,Math.round(c*fw),Math.round(r*fh),Math.round(fw),Math.round(fh));added++;}}if(added===0)tex.add("f0",0,0,0,iw,ih);}else tex.add("f0",0,0,0,iw,ih);}var akey=(ent.skin==="Bald")?ent.action+"_Bald":ent.action;if(!scene.anims.exists(akey)){var names=scene.textures.get(key).getFrameNames().filter(function(n){return(n+"").charAt(0)==="f";});if(names.length===0)names=["f0"];names=names.slice(0,want);scene.anims.create({key:akey,frames:names.map(function(n){return{key:key,frame:n};}),frameRate:ent.conf.fps,repeat:ent.conf.loop?-1:0});}}catch(e){console.error(e);}remaining--;maybeDone();};img.onerror=function(){remaining--;maybeDone();};img.src=ent.conf.url;});}};
var GameScene=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"game"});},init:function(){this.W=540;this.H=960;this.PLAYERS_COUNT=10;this.P_SPACING_MIN=1200;this.ballHoldOffsetX=-40;this.passIndex=0;this.missChance=0.05;this.MS_STEP=0.07;this.mult=0;this.inFlight=false;this.gameOver=false;this.flightTween=null;this.camSwayTween=null;this.baseX=null;this.players=[];this.positions=[];this.enemies=[];},preload:function(){},PlayerView:undefined,EnemyView:undefined,create:function(){var scene=this;Assets.load(scene,function(){scene.startGame();});if(!this.PlayerView){var P=function(scene,x,y,skin){this.scene=scene;this.skin=skin||"Hair";this.sprite=scene.add.sprite(x,y,"tx:"+this.skin+":Idle","f0").setOrigin(0.5,1);this._applyScale("Idle");};P.prototype._frameH=function(a){var t=ANIMS[this.skin]||{},c=t[a]||null;return c?c.frameH:300;};P.prototype._applyScale=function(a){var base=(ANIMS[this.skin]&&ANIMS[this.skin].Run)?ANIMS[this.skin].Run:{frameH:432};this.sprite.setScale(PLAYER_H*0.85/(a==="Kick"?base.frameH:this._frameH(a)));};P.prototype._lockFeet=function(apply){var b=this.sprite.getBottomCenter();apply.call(this);var a=this.sprite.getBottomCenter();this.sprite.y+=b.y-a.y;};P.prototype.playIdle=function(){var self=this;this._lockFeet(function(){self._applyScale("Idle");self.sprite.play(Assets.animKey("Idle",self.skin));});};P.prototype.playRunAmbient=function(){var self=this;this._lockFeet(function(){self._applyScale("Run");self.sprite.play(Assets.animKey("Run",self.skin));});};P.prototype.playKick=function(onTrig){var self=this,key=Assets.animKey("Kick",this.skin),sp=this.sprite,scn=this.scene;this._lockFeet(function(){self._applyScale("Kick");sp.play(key);});var kc=(ANIMS[this.skin]&&ANIMS[this.skin].Kick)||null;var d=kc?(kc.frames/kc.fps)*1000:600;scn.time.delayedCall(d*0.15,function(){onTrig&&onTrig();});};this.PlayerView=P;}if(!this.EnemyView){var E=function(scene,x,y){this.scene=scene;this.skin="Enemy";this.sprite=scene.add.sprite(x,y,"tx:Enemy:Enemy_Idle","f0").setOrigin(0.5,1);this._applyScale("Idle");};E.prototype._name=function(a){return"Enemy_"+a;};E.prototype._frameH=function(a){var t=ANIMS.Enemy||{},c=t[this._name(a)]||null;return c?c.frameH:432;};E.prototype._applyScale=function(a){this.sprite.setScale(PLAYER_H*0.85/this._frameH(a));};E.prototype._lockFeet=function(apply){var b=this.sprite.getBottomCenter();apply.call(this);var a=this.sprite.getBottomCenter();this.sprite.y+=b.y-a.y;};E.prototype.playIdle=function(){var self=this;this._lockFeet(function(){self._applyScale("Idle");self.sprite.play(self._name("Idle"));});};E.prototype.playRunAmbient=function(){var self=this;this._lockFeet(function(){self._applyScale("Run");self.sprite.play(self._name("Run"));if(self.sprite&&self.sprite.anims&&self.sprite.anims.setProgress)self.sprite.anims.setProgress(Math.random());});};this.EnemyView=E;}},legPosOf:function(node){return{x:node.x,y:node.y-PLAYER_H*0.05-60};},legPosAt:function(x,y){return{x:x,y:y-PLAYER_H*0.05-60};},startGame:function(){var bottom=this.H+600;var planeW=4320,worldH=7680;var top=bottom-worldH;this.cameras.main.setBounds(0,top,planeW,worldH);this.physics.world.setBounds(0,top,planeW,worldH);var tex=this.textures.exists("Grass")?this.textures.get("Grass").getSourceImage():null;if(tex){var iw2=tex.width||tex.naturalWidth||1,sc=this.W/iw2;this.field=this.add.tileSprite(planeW/2,top+worldH/2,planeW,worldH,"Grass").setDepth(-10);this.field.setTileScale(sc,sc);}else this.add.rectangle(planeW/2,top+worldH/2,planeW,worldH,0x0b5a2a).setDepth(-10);if(!ENABLE_FIELD_MARKS){this.marksTiles=[];for(var ry0=0;ry0<4;ry0++){for(var cx0=0;cx0<4;cx0++){var k0="FieldMarks_"+ry0+"_"+cx0;if(this.textures.exists(k0))this.textures.remove(k0);}}this._marksHiRes=false;}else{var mk=this._staticImgs&&this._staticImgs.FieldMarks;if(mk&&!this._marksHiRes){try{var iw=mk.naturalWidth||mk.width,ih=mk.naturalHeight||mk.height;var tilesX=4,tilesY=4,maxTex=4096,tW=planeW/tilesX,tH=worldH/tilesY;for(var ry=0;ry<tilesY;ry++){for(var cx=0;cx<tilesX;cx++){var key="FieldMarks_"+ry+"_"+cx;var sx=cx*tW,sy=ry*tH,sw=tW,sh=tH;var srcX=sx/planeW*iw,srcY=sy/worldH*ih,srcW=sw/planeW*iw,srcH=sh/worldH*ih;var scale=Math.min(1,Math.min(maxTex/sw,maxTex/sh));var cw=Math.max(1,Math.round(sw*scale)),ch=Math.max(1,Math.round(sh*scale));var cv=document.createElement("canvas");cv.width=cw;cv.height=ch;var ctx=cv.getContext("2d");ctx.drawImage(mk,srcX,srcY,srcW,srcH,0,0,cw,ch);if(this.textures.exists(key))this.textures.remove(key);this.textures.addCanvas(key,cv);}}this._marksHiRes=true;}catch(e){console.error(e);}}this.marksTiles=[];if(this._marksHiRes){var tW2=planeW/4,tH2=worldH/4;for(var ry2=0;ry2<4;ry2++){for(var cx2=0;cx2<4;cx2++){var key2="FieldMarks_"+ry2+"_"+cx2;if(!this.textures.exists(key2))continue;var cxw=(cx2+0.5)*tW2,cyw=top+(ry2+0.5)*tH2;var img=this.add.image(cxw,cyw,key2).setDepth(-9).setAlpha(0.8);img.setDisplaySize(tW2,tH2);this.marksTiles.push(img);}}}}var firstY=bottom-(PLAYER_H/2+220);var topTargetY=top+(PLAYER_H/2+220);var stepY=(firstY-topTargetY)/(this.PLAYERS_COUNT-1);var centerX=planeW/2;this.positions=[];this.players=[];for(var i=0;i<this.PLAYERS_COUNT;i++){var side=(i%2===0)?-1:1;var x=Phaser.Math.Clamp(centerX+side*Phaser.Math.Between(0,1000),60,planeW-60);var y=firstY-(stepY*i);this.positions.push({x:x,y:y});}for(i=0;i<this.PLAYERS_COUNT;i++){var pos=this.positions[i];var skin=(i%2===0)?"Hair":"Bald";var off=(i===0)?0:Phaser.Math.Between(300,600);var startY=pos.y-off;var view=new this.PlayerView(this,pos.x,startY,skin);view.playRunAmbient();var hy=view.sprite.y+off;this.players.push({node:view.sprite,view:view,homeX:pos.x,homeY:hy,entryOffY:off,entryDone:(i===0)});}if(this.players[0]&&this.players[0].node&&this.players[0].view){this.players[0].node.setPosition(this.players[0].homeX,this.players[0].homeY);this.players[0].view.playIdle();this.players[0].homeY=this.players[0].node.y;}this.enemies=[];for(i=1;i<this.PLAYERS_COUNT;i++){var pl=this.players[i];if(!pl||!pl.node)continue;if(Math.random()<0.5)continue;var px=pl.homeX,py=pl.homeY;var side=(px>=planeW/2)?-1:1;var dx=side*Phaser.Math.Between(150,250);var ex=px+dx;var ey=py+Phaser.Math.Between(-200,200);var eoff=Phaser.Math.Between(150,300);var ev=new this.EnemyView(this,ex,ey-eoff);ev.playRunAmbient();var ehy=ev.sprite.y+eoff;ev.sprite.setDepth(pl.node.depth);this.enemies.push({node:ev.sprite,view:ev,ownerIndex:i,homeY:ehy,entryOffY:eoff,entryDone:false});}var first=this.players[0].node;var leg=this.legPosOf(first);this.ball=this.add.sprite(leg.x+this.ballHoldOffsetX,leg.y,"tx:Ball:Fly","f0").setOrigin(0.5).setDepth(100);this.ballBaseScale=0.35;this.ball.setScale(this.ballBaseScale);this.ballBaseDepth=this.ball.depth;this.cameras.main.startFollow(this.ball,true,0.22,0.22);if(this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");}var last=this.players[this.PLAYERS_COUNT-1].node;this.goal=this.add.rectangle(planeW/2,last.y-260,110,26,0x2fd39f).setStrokeStyle(4,0x1aa67a).setDepth(9);this.add.text(this.goal.x,this.goal.y-36,"GOAL",{fontFamily:"Montserrat",fontStyle:"bold",fontSize:18,color:"#7fffd4"}).setOrigin(0.5).setDepth(9);var S=0.5,HUDD=1900;
/* In-game UI (UI2) based on game.html 1080x1920 layout scaled to 540x960 */
this.uiLogo=this.add.image((764+316/2)*S,(0+207/2)*S,"UI2_LogoTop").setScrollFactor(0).setDepth(HUDD).setDisplaySize(316*S,207*S);
this.uiBack=this.add.image((75+32/2)*S,(80+54/2)*S,"UI2_BackIcon").setScrollFactor(0).setDepth(HUDD).setDisplaySize(32*S,54*S);
this.uiHelp=this.add.image((919+55/2)*S,(1557+54/2)*S,"UI2_HelpIcon").setScrollFactor(0).setDepth(HUDD).setDisplaySize(55*S,54*S);
/* Avatar + name (bottom-left) */
this.uiAvatarRing=this.add.image((8+62+113/2)*S,(1703+113/2)*S,"UI2_AvatarRingS").setScrollFactor(0).setDepth(HUDD).setDisplaySize(113*S,113*S);
this.uiAvatarIcon=this.add.image((8+62+8+97/2)*S,(1703+8+96/2)*S,"UI2_AvatarIconS").setScrollFactor(0).setDepth(HUDD+1).setDisplaySize(97*S,96*S);
this.uiPlayerName=this.add.text((8+232/2)*S,(1703+140+18)*S,"TestCP55",{fontFamily:"Inter, Montserrat, sans-serif",fontStyle:"bold",fontSize:18,color:"#ffffff"}).setOrigin(0.5,0.5).setScrollFactor(0).setDepth(HUDD+2);
/* Counter (bottom-right) */
this.uiScoreRing=this.add.image((891+113/2)*S,(1698+113/2)*S,"UI2_AvatarRingS").setScrollFactor(0).setDepth(HUDD).setDisplaySize(113*S,113*S);
this.uiScoreBall=this.add.image((891+113/2)*S,(1698+113/2)*S,"UI2_BallIcon").setScrollFactor(0).setDepth(HUDD+1).setDisplaySize(113*S,113*S);
this.uiScoreText=this.add.text((891+8+49)*S,(1698+141+18)*S,"0 / 10",{fontFamily:"Inter, Montserrat, sans-serif",fontStyle:"bold",fontSize:18,color:"#ffffff"}).setOrigin(0.5,0.5).setScrollFactor(0).setDepth(HUDD+2);

/* PASS/CATCH button skinned as UI2 badge (keeps existing behavior) */
var mkBtn=(function(scene){return function(label,x,y,onTap){var img=scene.add.image(x,y,"UI2_ButtonPass").setDepth(HUDD+10).setScrollFactor(0).setDisplaySize(217*S,223*S);var tx=scene.add.text(x,y-4,label,{fontFamily:"Inter, Montserrat, sans-serif",fontStyle:"bold",fontSize:18,color:"#ffffff"}).setOrigin(0.5,0.5).setDepth(HUDD+11).setScrollFactor(0);img.setInteractive({useHandCursor:true}).on("pointerdown",function(){onTap();});return{show:function(v){img.setVisible(v);tx.setVisible(v);v?img.setInteractive({useHandCursor:true}):img.disableInteractive();},active:function(v){img.setAlpha(v?1:0.5);tx.setAlpha(v?1:0.5);v?img.setInteractive({useHandCursor:true}):img.disableInteractive();},setLabel:function(t){tx.setText(t);}};};})(this);
var btnX=(433+217/2)*S,btnY=(1557+223/2)*S;
this.passBtn=mkBtn("PASS",btnX,btnY,(function(scene){return function(){if(scene.inFlight||scene.gameOver)return;scene.setPassCatchState(false,true);scene.catchBtn&&scene.catchBtn.active&&scene.catchBtn.active(false);scene.pass();};})(this));
this.catchBtn=mkBtn("CATCH!",btnX,btnY,(function(scene){return function(){scene.catch();};})(this));
this.setPassCatchState(true,false);
this.updateHUD();},setPassCatchState:function(showPass,showCatch){this.passBtn&&this.passBtn.show(showPass);this.catchBtn&&this.catchBtn.show(showCatch);if(this.passBtn&&this.passBtn.setLabel){this.passBtn.setLabel("PASS");}if(this.catchBtn&&this.catchBtn.setLabel){this.catchBtn.setLabel("CATCH!");}if(showCatch&&this.catchBtn&&this.catchBtn.active)this.catchBtn.active(false);},stepForMult:function(m){var steps=this.PROGRESS_STEPS||10;var mm=Math.min(m,steps);return Phaser.Math.Clamp(mm,0,steps);},updateHUD:function(){var steps=10;var dm=Math.min(this.mult,steps);if(this.uiScoreText)this.uiScoreText.setText(dm+" / 10");},popMultiplierAt:function(target,mult){if(!target)return;var x=target.x,y=target.y-PLAYER_H-10;var txt=this.add.text(x,y,"x"+mult,{fontFamily:"Montserrat",fontStyle:"bold",fontSize:28,color:"#fff"}).setOrigin(0.5).setDepth(500);txt.setScale(0.4);txt.alpha=0;var scn=this;this.tweens.add({targets:txt,alpha:1,scaleX:2.4,scaleY:2.4,duration:210,ease:"Back.Out",onComplete:function(){scn.tweens.add({targets:txt,y:txt.y-24,alpha:0,duration:570,onComplete:function(){txt.destroy();}});}});},startEnemyEntry:function(owner,delay){for(var i=0;i<this.enemies.length;i++){var en=this.enemies[i];if(!en||!en.node||en.ownerIndex!==owner)continue;if(en.entryDone)return;en.entryDone=true;var self=this;var hy=(typeof en.homeY==="number")?en.homeY:en.node.y;var off=(typeof en.entryOffY==="number")?en.entryOffY:Phaser.Math.Between(150,300);en.entryOffY=off;var run=function(){if(!en.node||!en.node.scene)return;en.node.y=hy-off;self.tweens.add({targets:en.node,y:hy,duration:1600,ease:"Sine.easeOut",onComplete:function(){en.view&&en.view.playIdle&&en.view.playIdle();}});};(delay&&delay>0)?this.time.delayedCall(delay,run):run();return;}},startPlayerEntry:function(idx,delay){var pl=this.players[idx];if(!pl||!pl.node||pl.entryDone)return;pl.entryDone=true;var self=this;var hy=(typeof pl.homeY==="number")?pl.homeY:pl.node.y;var off=(typeof pl.entryOffY==="number")?pl.entryOffY:Phaser.Math.Between(300,600);pl.entryOffY=off;var run=function(){if(!pl.node||!pl.node.scene)return;pl.node.y=hy-off;self.tweens.add({targets:pl.node,y:hy,duration:600,ease:"Sine.easeOut"});};(delay&&delay>0)?this.time.delayedCall(delay,run):run();},pass:function(){var self=this;if(this.catchBtn&&this.catchBtn.active)this.catchBtn.active(false);if(this.passIndex>=this.PLAYERS_COUNT-1){var lastV=this.players[this.passIndex]&&this.players[this.passIndex].view;if(this.ball&&lastV&&lastV.sprite){this.ball.setDepth(lastV.sprite.depth-1);var ln=this.players[this.passIndex]&&this.players[this.passIndex].node;if(ln){var ll=this.legPosOf(ln);this.ball.setPosition(ll.x,ll.y);}}lastV&&lastV.playKick(function(){self.passToGoal();});return;}var pv=this.players[this.passIndex]&&this.players[this.passIndex].view;if(this.ball&&pv&&pv.sprite){this.ball.setDepth(pv.sprite.depth-1);var pn=this.players[this.passIndex]&&this.players[this.passIndex].node;if(pn){var lp=this.legPosOf(pn);this.ball.setPosition(lp.x,lp.y);}}pv&&pv.playKick(function(){self.toTarget(self.passIndex+1);});},toTarget:function(i){var self=this;var target=this.players[i]&&this.players[i].node;this.inFlight=true;var dur=(2000+Phaser.Math.Between(0,1000))*0.8;var delay=Math.floor(dur*0.6);this.startPlayerEntry(i,delay);this.startEnemyEntry(i,delay);var hx=(this.players[i]&&typeof this.players[i].homeX==="number")?this.players[i].homeX:(target?target.x:this.W/2);var hy=(this.players[i]&&typeof this.players[i].homeY==="number")?this.players[i].homeY:(target?target.y:0);var leg=this.legPosAt(hx,hy);var miss=Math.random()<this.missChance;if(miss){var mx=Phaser.Math.Linear(this.ball.x,leg.x,0.6)+Phaser.Math.Between(-80,80);var my=leg.y-120;this.flyArc(mx,my,dur,function(){self.fail();});this.cameras.main.shake(300,0.0045);return;}this.flyArc(leg.x+this.ballHoldOffsetX,leg.y,dur,function(){self.passIndex=i;self.players[i]&&self.players[i].view&&self.players[i].view.playIdle();self.mult+=1;self.missChance+=self.MS_STEP;self.inFlight=false;self.cameras.main.shake(300,0.0045);self.updateHUD();if(typeof catchConfetti==="function")catchConfetti();self.popMultiplierAt(target,self.mult);self.setPassCatchState(false,true);self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(true);self.time.delayedCall(1200,function(){self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(false);if(!self.inFlight&&!self.gameOver){if(i<self.PLAYERS_COUNT-1)self.pass();else self.passToGoal();}});},target);},passToGoal:function(){var self=this;var dur=(2000+Phaser.Math.Between(0,1000))*0.8;var miss=Math.random()<this.missChance;if(miss){var mx=this.goal.x+Phaser.Math.Between(-120,120);var my=this.goal.y-140;this.flyArc(mx,my,dur,function(){self.fail();});this.cameras.main.shake(300,0.0045);return;}this.flyArc(this.goal.x,this.goal.y+6,dur,function(){self.players[self.passIndex]&&self.players[self.passIndex].view&&self.players[self.passIndex].view.playIdle();self.mult+=1;self.missChance+=self.MS_STEP;self.inFlight=false;self.updateHUD();if(typeof catchConfetti==="function")catchConfetti();self.passIndex=0;var f=self.players[0]&&self.players[0].node;if(f&&self.ball){var l=self.legPosOf(f);self.ball.setPosition(l.x+self.ballHoldOffsetX,l.y);if(typeof self.ballBaseDepth==="number")self.ball.setDepth(self.ballBaseDepth);if(self.ball.anims&&self.ball.anims.stop)self.ball.anims.stop();if(self.ball.setFrame)self.ball.setFrame("f0");self.ball.setScale(self.ballBaseScale,self.ballBaseScale);}self.popMultiplierAt(f,self.mult);self.setPassCatchState(false,true);self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(true);self.time.delayedCall(1200,function(){self.catchBtn&&self.catchBtn.active&&self.catchBtn.active(false);if(!self.inFlight&&!self.gameOver)self.pass();});});},flyArc:function(tx,ty,d,cb,nextNode){var cam=this.cameras.main;if(cam&&cam.followOffset){var off=Phaser.Math.Between(-120,120);if(this.camSwayTween){this.camSwayTween.stop();this.camSwayTween=null;}this.camSwayTween=this.tweens.add({targets:cam.followOffset,x:off,duration:Math.max(300,Math.round(d*0.8)),ease:"Sine.easeInOut"});}var s=new Phaser.Math.Vector2(this.ball.x,this.ball.y);var e=new Phaser.Math.Vector2(tx,ty);var m=s.clone().add(e).scale(0.5);var tr=e.distance(s);var arc=Math.max(220,Phaser.Math.Clamp(tr*0.35,180,380));var c=new Phaser.Math.Vector2(m.x,m.y-arc);var curve=new Phaser.Curves.QuadraticBezier(s,c,e);var self=this;var flyKey=Assets.animKey("Fly","Ball");if(self.ball&&self.ball.anims&&self.anims&&self.anims.exists(flyKey))self.ball.play(flyKey);var depthSwitched=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}this.flightTween=this.tweens.addCounter({from:0,to:1,duration:d,ease:"Sine.easeInOut",onUpdate:function(tw){var t=tw.getValue();var p=curve.getPoint(t);self.ball.setPosition(p.x,p.y);var sc=(1+0.5*Math.sin(Math.PI*t))*1.2;self.ball.setScale(self.ballBaseScale*sc,self.ballBaseScale*sc);if(!depthSwitched&&t>=0.5&&nextNode){depthSwitched=true;self.ball.setDepth(nextNode.depth+1);}},onComplete:function(){self.flightTween=null;if(self.ball&&self.ball.anims){self.ball.anims.stop();self.ball.setFrame("f0");self.ball.setScale(self.ballBaseScale,self.ballBaseScale);}cb&&cb();}});},catch:function(){if(this.gameOver)return;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}this.inFlight=false;if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");this.ball.setScale(this.ballBaseScale,this.ballBaseScale);}this.gameOver=true;var mm=this.mult.toFixed(0);var amt=Math.round(100*this.mult);if(typeof showHtmlReward==="function")showHtmlReward(mm,amt);},fail:function(){this.inFlight=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");}this.gameOver=true;this.tweens.add({targets:this.ball,scaleX:1.5,scaleY:1.5,yoyo:true,repeat:1,duration:160});if(typeof showHtmlLose==="function")showHtmlLose(this.mult.toFixed(0));},restart:function(){if(typeof hideHtmlReward==="function")hideHtmlReward();if(typeof hideHtmlLose==="function")hideHtmlLose();this.gameOver=false;this.inFlight=false;if(this.flightTween){this.flightTween.stop();this.flightTween=null;}if(this.ball&&this.ball.anims){this.ball.anims.stop();this.ball.setFrame("f0");this.ball.setScale(this.ballBaseScale,this.ballBaseScale);}this.passIndex=0;this.missChance=0.05;this.mult=0;for(var i=0;i<this.players.length;i++){var pl=this.players[i];if(!pl||!pl.view||!pl.node)continue;if(typeof pl.homeX==="number")pl.node.x=pl.homeX;if(typeof pl.homeY!=="number")pl.homeY=pl.node.y;if(typeof pl.entryOffY!=="number")pl.entryOffY=(i===0)?0:Phaser.Math.Between(300,600);if(i===0){pl.entryDone=true;pl.node.y=pl.homeY;pl.view.playIdle();}else{pl.entryDone=false;pl.node.y=pl.homeY-pl.entryOffY;pl.view.playRunAmbient();}}for(i=0;i<this.enemies.length;i++){var en=this.enemies[i];if(!en||!en.view||!en.node)continue;en.view.playRunAmbient&&en.view.playRunAmbient();var pi=en.ownerIndex;var pn=this.players[pi]&&this.players[pi].node;if(pn)en.node.setDepth(pn.depth);var hy=(typeof en.homeY==="number")?en.homeY:en.node.y;if(typeof en.entryOffY!=="number")en.entryOffY=Phaser.Math.Between(150,300);en.entryDone=false;en.node.y=hy-en.entryOffY;}var f=this.players[0].node;var l=this.legPosOf(f);this.ball.setPosition(l.x+this.ballHoldOffsetX,l.y);this.ball.setScale(this.ballBaseScale,this.ballBaseScale);if(typeof this.ballBaseDepth==="number")this.ball.setDepth(this.ballBaseDepth);if(this.camSwayTween){this.camSwayTween.stop();this.camSwayTween=null;}this.cameras.main.followOffset&& (this.cameras.main.followOffset.x=0);this.cameras.main.startFollow(this.ball,true,0.22,0.22);this.cameras.main.pan(this.ball.x,this.ball.y,0);this.setPassCatchState(true,false);this.updateHUD();}});
function bootGame(){try{window._GAME&&window._GAME.destroy&&window._GAME.destroy(true);}catch(e){console.error(e);}var m=document.getElementById("game");if(m)m.innerHTML="";window._GAME=new Phaser.Game({type:Phaser.AUTO,parent:"game",backgroundColor:"#0b1f2a",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:540,height:960},dom:{createContainer:true},physics:{default:"arcade",arcade:{debug:false}},scene:[GameScene]});}
</script>
</body>
</html>
